<!DOCTYPE html>
<html lang="sr">
<head>
  <meta charset="UTF-8">
  <title>Lokacije Prodavnica</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', sans-serif;
      background: #f0f2f5;
    }
    .vf-container {
      width: 100%;
      height: 300px;
      display: flex;
      flex-direction: column;
    }
    .header {
      background: #2c3e50;
      color: white;
      padding: 10px;
      text-align: center;
      font-size: 18px;
      border-radius: 5px 5px 0 0;
    }
    .content {
      flex: 1;
      display: flex;
      flex-direction: column;
      background: white;
      border: 1px solid #ddd;
      border-top: none;
      border-radius: 0 0 5px 5px;
      overflow: hidden;
    }
    .select-container {
      padding: 10px;
    }
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
      font-size: 14px;
    }
    select {
      width: 100%;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 14px;
    }
    #map {
      flex: 1;
      border-top: 1px solid #eee;
    }
    .infowindow {
      max-width: 250px;
      font-size: 13px;
      line-height: 1.4;
    }
    .infowindow strong {
      display: block;
      margin-bottom: 5px;
    }
    .hours-toggle {
      color: #0066cc;
      cursor: pointer;
      text-decoration: underline;
      margin: 5px 0;
      display: inline-block;
    }
    .full-hours {
      font-size: 12px;
      margin-top: 5px;
    }
    .open-status {
      font-weight: bold;
      margin-top: 5px;
      font-size: 13px;
    }
  </style>
</head>
<body>
  <div class="vf-container">
    <div class="header">üìç Lokacije Prodavnica</div>
    <div class="content">
      <div class="select-container">
        <label for="citySelect">Izaberi grad:</label>
        <select id="citySelect">
          <option value="all">-- Prika≈æi sve --</option>
        </select>
      </div>
      <div id="map"></div>
    </div>
  </div>

  <script>
    const storeData = [
      { city: "Beograd", name: "Roda Centar", address: "ƒêorƒëa Stanojeviƒáa 35, Novi Beograd, Srbija", phone: "011/123-456", hours: {
        "Ponedeljak": ["08:00", "21:00"], "Utorak": ["08:00", "21:00"], "Sreda": ["08:00", "21:00"],
        "ƒåetvrtak": ["08:00", "21:00"], "Petak": ["08:00", "21:00"], "Subota": ["09:00", "20:00"], "Nedelja": ["10:00", "18:00"]
      }},
      { city: "Beograd", name: "Roda Centar", address: "Pilota Mihaila Petroviƒáa 72, Beograd, Srbija", phone: "011/678-901", hours: {
        "Ponedeljak": ["08:00", "21:00"], "Utorak": ["08:00", "21:00"], "Sreda": ["08:00", "21:00"],
        "ƒåetvrtak": ["08:00", "21:00"], "Petak": ["08:00", "21:00"], "Subota": ["09:00", "20:00"], "Nedelja": ["10:00", "18:00"]
      }}
    ];

    let map, geocoder, markers = [], activeInfoWindow = null;

    function initMap() {
      map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: 44.7866, lng: 20.4489 },
        zoom: 12,
        zoomControl: true,
        streetViewControl: false,
        mapTypeControl: false,
        fullscreenControl: false
      });

      geocoder = new google.maps.Geocoder();

      const citySelect = document.getElementById("citySelect");
      const cities = [...new Set(storeData.map(store => store.city))];
      
      cities.forEach(city => {
        const option = document.createElement("option");
        option.value = city;
        option.textContent = city;
        citySelect.appendChild(option);
      });

      citySelect.addEventListener("change", () => {
        const selectedCity = citySelect.value;
        const filteredStores = selectedCity === "all" 
          ? storeData 
          : storeData.filter(store => store.city === selectedCity);
        clearMarkers();
        showMarkers(filteredStores);
        
        if (filteredStores.length === 1) {
          map.setZoom(15);
        }
      });

      showMarkers(storeData);
    }

    function clearMarkers() {
      markers.forEach(marker => marker.setMap(null));
      markers = [];
    }

    function showMarkers(stores) {
      const bounds = new google.maps.LatLngBounds();
      
      stores.forEach(store => {
        geocoder.geocode({ address: store.address }, (results, status) => {
          if (status === "OK" && results[0]) {
            const location = results[0].geometry.location;
            const marker = new google.maps.Marker({
              map,
              position: location,
              title: store.name
            });

            const infoWindow = new google.maps.InfoWindow({
              content: createInfoWindowContent(store)
            });

            marker.addListener("click", () => {
              if (activeInfoWindow) activeInfoWindow.close();
              infoWindow.open(map, marker);
              activeInfoWindow = infoWindow;
            });

            markers.push(marker);
            bounds.extend(location);
            
            if (stores.length > 1) {
              map.fitBounds(bounds);
            } else {
              map.setCenter(location);
              map.setZoom(15);
            }
          }
        });
      });
    }

    function createInfoWindowContent(store) {
      const openStatus = isStoreOpen(store.hours) ? "‚úÖ Otvoreno" : "‚ùå Zatvoreno";
      
      let hoursHTML = '';
      for (const [day, hours] of Object.entries(store.hours)) {
        hoursHTML += `<div>${day}: ${hours[0]} - ${hours[1]}</div>`;
      }

      return `
        <div class="infowindow">
          <strong>${store.name}</strong>
          <div>${store.address}</div>
          <div><b>Telefon:</b> ${store.phone}</div>
          <div class="hours-toggle" onclick="toggleHours(this)">‚ñº Radno vreme</div>
          <div class="full-hours" style="display:none">${hoursHTML}</div>
          <div class="open-status">${openStatus}</div>
        </div>
      `;
    }

    function isStoreOpen(hours) {
      const days = ["Nedelja", "Ponedeljak", "Utorak", "Sreda", "ƒåetvrtak", "Petak", "Subota"];
      const now = new Date();
      const day = days[now.getDay()];
      const currentTime = now.toTimeString().substr(0, 5);
      
      if (!hours[day]) return false;
      return currentTime >= hours[day][0] && currentTime <= hours[day][1];
    }

    function toggleHours(element) {
      const details = element.nextElementSibling;
      details.style.display = details.style.display === "none" ? "block" : "none";
      element.textContent = details.style.display === "none" ? "‚ñº Radno vreme" : "‚ñ≤ Radno vreme";
    }

    window.toggleHours = toggleHours;
  </script>

  <script async src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDOnUBcLX02oRYFR9sLrBISoOgOz9ziliU&callback=initMap"></script>
</body>
</html>
